<p>The T-SQL relational operators PIVOT and UNPIVOT are super useful, but I use them *just* infrequently enough where I can never remember the exact syntax from memory. I decided to create this post for a quick reference for myself, and maybe someone will also find it handy.</p>
<p>First off, what do PIVOT and UNPIVOT do? PIVOT will turn row values into columns, and UNPIVOT can turn columns into row values. It's easier to visualize by following the examples below. I wanted the examples to be a quick copy/paste/run into SQL Server Management Studio, so the source table is a hard-coded inline table from a <a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/table-value-constructor-transact-sql">VALUES</a> table constructor.</p>
<h2>Initial Table</h2>
<p>The first query shows the initial data set.</p>
<p>[sql]SELECT<br>T.Name,<br>T.Val1,<br>T.Val2<br>FROM<br>(VALUES<br>('Apple', 'A1', 'A2'),<br>('Banana', 'B1', 'B2'),<br>('Cat', 'C1', 'C2')<br>) AS T(Name, Val1, Val2)<br>;[/sql]<br><img src="/wp-content/uploads/resultset01.png" alt="Source Table"></p>
<h2>UNPIVOT</h2>
<p>This query takes the table-valued constructor from the first query and UNPIVOTS it.</p>
<p>[sql]SELECT<br>UNPVT.Name,<br>UNPVT.NEW_COLUMN_NAME,<br>UNPVT.EXISTING_COL_NAME<br>FROM<br>(VALUES<br>('Apple', 'A1', 'A2'),<br>('Banana', 'B1', 'B2'),<br>('Cat', 'C1', 'C2')<br>) AS T(Name, Val1, Val2)<br>UNPIVOT<br>(NEW_COLUMN_NAME FOR EXISTING_COL_NAME IN (Val1, Val2)) AS UNPVT;[/sql]<br><img src="/wp-content/uploads/resultset02.png" alt="Results of UNPIVOT"></p>
<h2>PIVOT</h2>
<p>This query demonstrates PIVOT. It uses a hard-coded equivalent of the result set of query #2 and PIVOTS it back to the original form (embedding an UNPIVOT of the VALUES table-constructor started to look a little too busy and took the focus away from the PIVOT syntax). Note that an aggregate operator is needed, and the FOR clause matches the FOR clause in the UNPIVOT example.</p>
<p>[sql]SELECT<br>Pvt.Name,<br>Pvt.Val1,<br>Pvt.Val2<br>FROM<br>(VALUES<br>('Apple', 'A1', 'Val1'),<br>('Apple', 'A2', 'Val2'),<br>('Banana', 'B1', 'Val1'),<br>('Banana', 'B2', 'Val2'),<br>('Cat', 'C1', 'Val1'),<br>('Cat', 'C2', 'Val2'))<br>AS T(Name, NEW_COLUMN_NAME, EXISTING_COL_NAME)<br>PIVOT (<br>MIN(NEW_COLUMN_NAME) FOR EXISTING_COL_NAME IN ([Val1], [Val2])<br>) as Pvt;[/sql]<br><img src="/wp-content/uploads/resultset03.png" alt="Results of PIVOT the results of UNPIVOT"></p>
<h2>Conclusion</h2>
<p>Official documentation can be found (among other places) at <a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot">https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot</a>. Happy pivoting!</p>
